<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soporte TV WATCH</title>
    <style>
        .oculto {
        display: none;
    }
    .visible {
        display: block;
    }
    </style>    
    <script>
        function subirPregunta(codigo) {
            console.log(codigo);
            let pregunta = document.getElementById("preguntaTexto").value;
            localStorage.setItem(`pregunta${codigo}`, pregunta);
            alert('Pregunta enviada con éxito');
        }
        function subirRespuesta(codigo) {
            let respuesta = document.getElementById(`respuesta${codigo}`).value;
            localStorage.setItem(`respuesta${codigo}`, respuesta);
            alert('Respuesta subida con éxito');
        }
        onload = () => {
            usuarioActual = JSON.parse(sessionStorage.getItem("usuarioActual"));
            let contenedor = document.getElementById("preguntasUsuarios");
            let contenido = `<h1>Preguntas frecuentes</h1>`;
            let listaUsuarios = JSON.parse(localStorage.getItem("listaUsuarios"));
            listaUsuarios.forEach(usuario => {
                let preguntasUsuario = localStorage.getItem(`pregunta${usuario.codigo}`);
                let respuestasUsuario = localStorage.getItem(`respuesta${usuario.codigo}`);
                if (preguntasUsuario) {
                    if (usuarioActual.admin == "S") {
                        contenido += `<p>Usuario: ${usuario.nombre}</p>`;
                    }
                    contenido += `<p>Pregunta: ${preguntasUsuario}</p>`;
                    if (respuestasUsuario) {
                        contenido += `<p>Respuesta: ${respuestasUsuario}</p>`;
                    } else {
                        if (usuarioActual.admin == "S") {
                            contenido += `<p>Respuesta: <input type="text" id="respuesta${usuario.codigo}"></p>`;
                            contenido += `<p><button type="button" onclick="subirRespuesta(${usuario.codigo})">Subir respuesta</button></p>`
                        }
                    }
                    contenedor.insertAdjacentHTML("beforeend", contenido);
                }
            })
            console.log(usuarioActual)
            if (usuarioActual.admin != "S") {
                document.getElementById("pregunta").className="visible";
                document.getElementById("botonPreguntas").className = "visible";
                document.getElementById("botonPreguntas").addEventListener("click", () => {
                    subirPregunta(usuarioActual.codigo);
                });
            }
        }
    </script>
</head>

<body>
    <h1>PREGUNTAS FRECUENTES</h1>
    <div id="preguntasUsuarios"></div>
    <p id="pregunta" class="oculto">Preguntanos lo que quieras: <input type="text" id="preguntaTexto"></p>
    <button type="button" id="botonPreguntas" class="oculto">Subir preguntas</button>
</body>

</html>