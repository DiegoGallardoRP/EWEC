<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/">
    <style>
        body {
            background-color: red;
        }

        .oculto {
            display: none;
        }

        .cruz {
            height: 150px;
            width: 150px;
        }

        .visible {
            display: block;
        }

        .fotoPeli,
        .fotoSerie {
            height: 280px;
            width: 170px;
        }

        ul {
            display: inline;
        }
    </style>
    <script src="./clases/Usuario.js"></script>
    <script src="./clases/Peliculas.js"></script>
    <script src="./clases/Series.js"></script>
    <script>
        var listaDePeliculas = [];
        var listaDeSeries = [];
        let indicePaginaPelis = 0;
        const pelisPorPagina = 5;
        let indicePaginaSeries = 0;
        const seriesPorPagina = 5;
        let mostrandoPelis = true;
        let mostrandoSeries = true;
        let esAdmin = false;

        function mostrarUsuario() {
            let usuarioGuardado = sessionStorage.getItem("usuarioActual");
            if (usuarioGuardado) {
                let usuario = JSON.parse(usuarioGuardado);
                document.getElementById("nombreUsuario").textContent = "Bienvenido, " + usuario.nombre;
                esAdmin = usuario.admin == "S";
            }
        }

        function cargarPeliculas() {
            listaDePeliculas.push(new Pelicula("IT", "Stephen King", "Terror", "it.jpg", "https://www.youtube.com/watch?v=_oBZ_zTz0Nw"));
            listaDePeliculas.push(new Pelicula("Alien", "David Fincher", "Terror", "alien.jpg", ""));
            listaDePeliculas.push(new Pelicula("Inactividad Paranormal", "Michael Tiddes", "Comedia", "inact.jpg", ""));
        }

        function cargarSeries() {
            listaDeSeries.push(new Serie("Cómo conocí a vuestra madre", "Carter Bays Craig Thomas", "Comedia", "madre.jpg", "https://www.youtube.com/watch?v=90OxzHzvWSg"));
        }

        function mostrarTodoPorCategoria() {
            let contenedor = document.getElementById("contenidoPrincipal");
            contenedor.innerHTML = "";
            const categorias = ["Terror", "Ciencia Ficcion", "Comedia", "Animacion", "Accion"];

            categorias.forEach(categoria => {
                let peliculasFiltradas = listaDePeliculas.filter(peli => peli.categoria === categoria);
                let seriesFiltradas = listaDeSeries.filter(serie => serie.categoria === categoria);

                if (peliculasFiltradas.length > 0 || seriesFiltradas.length > 0) {
                    let seccionCategoria = `<div id="categoriaSeccion">
                                                <h2>${categoria}</h2>`;

                    if (peliculasFiltradas.length > 0) {
                        seccionCategoria += `<h3>Películas</h3><ul class="peliculas-list">`;
                        peliculasFiltradas.forEach(peli => {
                            seccionCategoria += `<li><img src="./imagenes/${peli.foto}" alt="${peli.titulo}" class="fotoPeli" onclick="mostrarPeliDetalle('${peli.titulo}')"></li>`;
                        });
                        if (esAdmin) {
                            seccionCategoria += `<li><img src="./imagenes/cruz.png" class="cruz" onclick="anadirPeli('${categoria}')"></li>`;
                            seccionCategoria += `<button type="button" onclick="mostrarDivPeli('${categoria}')">Borrar</button>`;
                        }
                        seccionCategoria += `</ul>`;
                    }

                    if (seriesFiltradas.length > 0) {
                        seccionCategoria += `<h3>Series</h3><ul class="series-list">`;
                        seriesFiltradas.forEach(serie => {
                            seccionCategoria += `<li><img src="./imagenes/${serie.foto}" alt="${serie.titulo}" class="fotoSerie" onclick="mostrarSerieDetalle('${serie.titulo}')"></li>`;
                        });
                        if (esAdmin) {
                            seccionCategoria += `<li><img src="./imagenes/cruz.png" class="cruz" onclick="anadirSerie('${categoria}')"></li>`;
                            seccionCategoria += `<button type="button" onclick="mostrarDivSerie('${categoria}')">Borrar</button>`;
                        }
                        seccionCategoria += `</ul>`;
                    }

                    seccionCategoria += `</div>`;
                    contenedor.insertAdjacentHTML("beforeend", seccionCategoria);
                }
            });
        }

        function mostrarPeliculasPorCategoria() {
            mostrandoPelis = true;
            mostrandoSeries = false;
            let contenedor = document.getElementById("contenidoPrincipal");
            contenedor.innerHTML = "";
            const categorias = ["Terror", "Ciencia Ficcion", "Comedia", "Animacion", "Accion"];

            categorias.forEach(categoria => {
                let peliculasFiltradas = listaDePeliculas.filter(peli => peli.categoria === categoria);

                if (peliculasFiltradas.length > 0) {
                    let seccionCategoria = `<div id="categoriaSeccion">
                                                <h2>${categoria} - Películas</h2><ul class="peliculas-list">`;
                    peliculasFiltradas.forEach(peli => {
                        seccionCategoria += `<li><img src="./imagenes/${peli.foto}" alt="${peli.titulo}" class="fotoPeli" onclick="mostrarPeliDetalle('${peli.titulo}')"></li>`;
                    });
                    seccionCategoria += `</ul></div>`;
                    contenedor.insertAdjacentHTML("beforeend", seccionCategoria);
                }
            });
        }

        function mostrarSeriesPorCategoria() {
            mostrandoPelis = false;
            mostrandoSeries = true;
            let contenedor = document.getElementById("contenidoPrincipal");
            contenedor.innerHTML = "";
            const categorias = ["Terror", "Ciencia Ficcion", "Comedia", "Animacion", "Accion"];

            categorias.forEach(categoria => {
                let seriesFiltradas = listaDeSeries.filter(serie => serie.categoria === categoria);

                if (seriesFiltradas.length > 0) {
                    let seccionCategoria = `<div id="categoriaSeccion">
                                                <h2>${categoria} - Series</h2><ul class="series-list">`;
                    seriesFiltradas.forEach(serie => {
                        seccionCategoria += `<li><img src="./imagenes/${serie.foto}" alt="${serie.titulo}" class="fotoSerie" onclick="mostrarSerieDetalle('${serie.titulo}')"></li>`;
                    });
                    seccionCategoria += `</ul></div>`;
                    contenedor.insertAdjacentHTML("beforeend", seccionCategoria);
                }
            });
        }

        function filtrarPorTitulo() {
            let tituloBusqueda = document.getElementById("barraDeBusqueda").value;
            if (tituloBusqueda == "") {
                mostrarTodoPorCategoria();
            } else {
                let listaPelisFiltrada = listaDePeliculas.filter((peli) => peli.titulo.toLocaleLowerCase().includes(tituloBusqueda.toLocaleLowerCase()));
                let listaSeriesFiltrada = listaDeSeries.filter((serie) => serie.titulo.toLocaleLowerCase().includes(tituloBusqueda.toLocaleLowerCase()));
                mostrarPeliculas(listaPelisFiltrada);
                mostrarSeries(listaSeriesFiltrada);
            }
        }

        window.onload = function () {
            cargarPeliculas();
            cargarSeries();
            mostrarUsuario();
            mostrarTodoPorCategoria();
        }
    </script>
</head>

<body>
    <nav>
        <ul>
            <li><img src="" id="perfil"><img src=""><p id="nombreUsuario"></p></li>
            <li><input type="text" id="barraDeBusqueda" onkeyup="filtrarPorTitulo()"><img href="" id="lupa"></li>
            <ul>
                <li><a href="#" onclick="mostrarPeliculasPorCategoria()">Películas</a></li>
                <li><a href="#" onclick="mostrarSeriesPorCategoria()">Series</a></li>
            </ul>
        </ul>
    </nav>
    <div id="contenidoPrincipal"></div>
</body>

</html>